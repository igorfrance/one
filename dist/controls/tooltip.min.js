one.controls.tooltip=function a(){function b(a,c,d){var e={orientation:a,arrow:{left:0,top:0}},f=null!=a.match(/T|B/),g="B";switch(a){case"T":g="B";break;case"B":g="T";break;case"L":g="R";break;case"R":g="L"}var h=f?one.HtmlControl.PROPS.VERTICAL:one.HtmlControl.PROPS.HORIZONTAL,i="top"==h.position?"bottom":"right",j=this.settings.showArrow?u.$arrow[h.size]():0;f&&(j/=2);var k=this.$element.offset(),l=$(u.document)[h.scrollPos](),m=u.offset[h.position]+k[h.position]-l,n=u.$popup[h.outerSize]()+j,o=this.$element[h.outerSize]();a.match(/T|L/)?(e[h.position]=m-n-this.settings.offset,e.arrow[h.position]="auto",e.arrow[i]=0):(e[h.position]=m+o+this.settings.offset,e.arrow[h.position]=0,e.arrow[i]="auto");var p=n>d-c;return!p&&e[h.position]<c?b.call(this,g,c,d):!p&&e[h.position]+n>d?b.call(this,g,c,d):e}function c(a,b,d,e){var f={orientation:b,arrow:{left:1,top:1}},g=null!=b.match(/T|B/);"C"==b&&(g=null!=a.match(/L|R/));var h="B";switch(b){case"T":h="B";break;case"B":h="T";break;case"L":h="R";break;case"R":h="L";break;default:h=g?"B":"R"}var i=g?one.HtmlControl.PROPS.VERTICAL:one.HtmlControl.PROPS.HORIZONTAL,j=this.settings.showArrow?u.$arrow[i.size]():0,k=this.$element.offset(),l=$(u.document)[i.scrollPos](),m=u.offset[i.position]+k[i.position]-l,n=u.$popup[i.outerSize](),o=this.$element[i.outerSize]();if(b.match(/T|L/)?(f[i.position]=m,f.arrow[i.position]=this.settings.arrowOffset):b.match(/B|R/)?(f[i.position]=m+o-n,f.arrow[i.position]=n-j-this.settings.arrowOffset):(f[i.position]=m+(o/2-n/2),f.arrow[i.position]=n/2-j/2),f.oversized=n>e-d,f.beyondFirstEdge=f[i.position]<d,f.beyondSecondEdge=f[i.position]+n>e,f.orientationRev=h,!f.oversized&&arguments.callee.caller!=arguments.callee&&(f.beyondFirstEdge||f.beyondSecondEdge)){var p=c.call(this,a,h,d,e);return"C"==b&&(p.beyondFirstEdge||p.beyondSecondEdge)&&(p=c.call(this,a,p.orientationRev,d,e)),p}return f}function d(){window.clearTimeout(r)}function e(){this.hideTooltip()}function f(){window.clearTimeout(r),u.instance&&u.instance!=this&&!u.instance.settings.hideOn.contains("mouseout")||this.settings.showOn.contains("mouseover")&&(this.$element.hasClass("tooltip-suspend")||(this.settings.showDelay>0?r=window.setTimeout(this.showTooltip,this.settings.showDelay):this.showTooltip()))}function g(){window.clearTimeout(r),u.instance==this&&this.settings.hideOn.contains("mouseout")&&(this.settings.hideDelay>0?r=window.setTimeout(this.hideTooltip,this.settings.hideDelay):this.hideTooltip())}function h(){this.settings.showOn.contains("focus")&&this.show()}function i(){this.settings.hideOn.contains("blur")&&this.hide()}function j(){u.$popup.is(":visible")&&this.settings.hideOn.contains("click")?this.hide():!u.$popup.is(":visible")&&this.settings.showOn.contains("click")&&this.show()}function k(a){u.$popup.is(":visible")&&u.instance==this&&(jQuery.contains(this.$element[0],a.target)||jQuery.contains(u.$popup[0],a.target)||this.hide())}function l(){this.hide()}function m(a){var b=u.$arrow.width(),c=u.$arrow.height(),d=u.$popup.find(".bg"),e=d.css("border-bottom-color"),f=parseInt(d.css("border-bottom-width")),g=d.css("background-color");switch(a){case"L":n(u.cL,g,e,f,function(a){a.moveTo(b/2,0),a.lineTo(0,c/2),a.lineTo(b/2,c)});break;case"R":n(u.cR,g,e,f,function(a){a.moveTo(0,0),a.lineTo(b/2,c/2),a.lineTo(0,c)});break;case"B":n(u.cB,g,e,f,function(a){a.moveTo(0,0),a.lineTo(b/2,c/2),a.lineTo(b,0)});break;case"T":n(u.cT,g,e,f,function(a){a.moveTo(0,c/2),a.lineTo(b/2,0),a.lineTo(b,c/2)})}}function n(a,b,c,d,e){var f=a.getContext("2d");f.clearRect(0,0,a.width,a.height),f.fillStyle=b,f.strokeStyle=c,f.lineWidth=d,f.beginPath(),e(f),f.fill(),d&&f.stroke()}function o(){p(),q(),$(window).resize(p),s=!0}function p(){u.offset.top=0,u.offset.left=0;var a=!1;try{u.document=top.document}catch(b){u.document=document,a=!0}if(!a){var c=window;if(window!=window.parent)for(;c!=top;){c=c.parent;for(var d=$("iframe, frame",c.document),e=!1,f=0;f<d.length;f++)if(d[f].contentWindow==window){u.offset.left+=d.eq(f).offset().left,u.offset.top+=d.eq(f).offset().top,e=!0;break}}}}function q(){if(u.$popup=$(t),u.$popup.appendTo($(u.document.body)),u.document!=document){var a=$("<style id='tooltipStyles'></style>");$(u.document.body).append(a);for(var b=[],c=one.css.findRules(".onetooltippopup"),d=0;d<c.length;d++){var e=c[d];b.push(e.css.cssText)}a.html(b.join("\n"))}u.$content=u.$popup.find(".content"),u.$arrow=u.$popup.find(".arrow");var f=u.$arrow.width(),g=u.$arrow.height(),h=$('<canvas class="b" width="{0}" height="{1}"/>'.format(f,g/2)).appendTo(u.$arrow)[0],i=$('<canvas class="t" width="{0}" height="{1}"/>'.format(f,g/2)).appendTo(u.$arrow)[0],j=$('<canvas class="l" width="{0}" height="{1}"/>'.format(f/2,g)).appendTo(u.$arrow)[0],k=$('<canvas class="r" width="{0}" height="{1}"/>'.format(f/2,g)).appendTo(u.$arrow)[0];u.cB=h,u.cT=i,u.cL=j,u.cR=k}var r,s=!1,t='<div class="onetooltippopup"><div class="arrow"></div><div class="bg"></div><div class="content"></div></div>',u={};u.instance=null,u.$popup=null,u.$arrow=null,u.document=null,u.$content=null,u.offset={left:0,top:0};var a=one.HtmlControl.extend(function(a,b){s||o(),this.construct(a),this.settings=new v(a,b),this.$element.data("tooltip",this).bind("mouseenter",$.proxy(f,this)).bind("mouseleave",$.proxy(g,this)).bind("focus",$.proxy(h,this)).bind("blur",$.proxy(i,this)).bind("click",$.proxy(j,this));var c=this.settings.content?this.$element.find(this.settings.content).html():this.$element.data("title")||this.$element.attr("title")||this.$element.attr("data-title");this.$element.data("title",c),this.$element.attr("data-title",c),this.$element.attr("title",one.string.EMPTY),this.showTooltip=$.proxy(this.show,this),this.hideTooltip=$.proxy(this.hide,this),$(u.document).on("keydown click",$.proxy(k,this)).on("scroll",$.proxy(l,this)),u.$popup.on("click",$.proxy(j,this)).on("mouseenter",$.proxy(d,this)).on("mouseleave",$.proxy(e,this))});a.prototype.hide=function(){u.$popup.hide(),u.$popup.removeClass(u.$popup.attr("class-added")),u.instance=null},a.prototype.show=function(){if(!this.$element.hasClass("tooltip-suspend")&&!this.$element.hasClass("disabled")){if(this.settings.obscureOnly){var a=this.$element[0];if(a.scrollWidth<=a.offsetWidth&&a.scrollHeight<=a.offsetHeight)return}var d=this.$element.data("title");if(d){u.$content.html(d);var e=this.settings.orientation,f=e[0].match(/T|L|R|B/)?e[0]:"T",g=e[1].match(/T|L|R|B|C/)?e[1]:"L",h=$("html",u.document)[0],i=$("body",u.document)[0],j=h.offsetWidth||i.offsetWidth,k=h.offsetHeight||i.offsetHeight;u.$popup.css({left:0,top:-1e3,display:"block"}).removeClass("t l r b -t -l -r -b"),u.$popup.addClass(this.settings.className).attr("class-added",this.settings.className),u.$arrow.toggle(this.settings.showArrow);var l,n;if(f.match(/T|B/)){l=b.call(this,f,0,k),n=c.call(this,f,g,0,j);var o={popupLeft:n.left,popupTop:l.top,arrowLeft:n.arrow.left,arrowTop:l.arrow.top,orientation:l.orientation,orientationS:n.orientation}}else l=b.call(this,f,0,j),n=c.call(this,f,g,0,k),o={popupLeft:l.left,popupTop:n.top,arrowLeft:l.arrow.left,arrowTop:n.arrow.top,orientation:l.orientation,orientationS:n.orientation};if(u.$popup.css({left:o.popupLeft,top:o.popupTop}),u.$arrow.css({left:o.arrowLeft,top:o.arrowTop}),this.settings.showArrow)switch(f){case"T":m.call(this,"B");break;case"B":m.call(this,"T");break;case"L":m.call(this,"R");break;case"R":m.call(this,"L")}u.$popup.addClass(o.orientation.toLowerCase()),u.$popup.addClass("-"+o.orientationS.toLowerCase()),u.instance=this,u.$popup.css({display:"block",opacity:1})}}},a.prototype.set=function(a,b){return!b||"showOn"!=a&&"hideOn"!=a||(b=b.split(/(?:\s*,\s*)|(?:\s+)/)),void 0!=this.settings[a]&&(this.settings[a]=b),this.settings[a]};var v=one.Settings.extend(function(a,b){this.construct(a,b),this.className=this.getString("className",a,b,null),this.followMouse=this.getBoolean("followMouse",a,b,!0),this.maxWidth=this.getString("maxWidth",a,b,null),this.showOn=this.getString("showOn",a,b,"mouseover").split(/(?:\s*,\s*)|(?:\s+)/),this.hideOn=this.getString("hideOn",a,b,"mouseout").split(/(?:\s*,\s*)|(?:\s+)/),this.orientation=this.getString("orientation",a,b,"TC").toUpperCase(),this.offset=this.getNumber("offset",a,b,3),this.showDelay=this.getNumber("show-delay",a,b,200),this.hideDelay=this.getNumber("hide-delay",a,b,0),this.obscureOnly=this.getBoolean("obscureOnly",a,b,!1),this.useFades=this.getBoolean("useFades",a,b,!1),this.showArrow=this.getBoolean("showArrow",a,b,!0),this.arrowOffset=this.getNumber("arrow-offset",a,b,5),this.content=this.getString("content",a,b,null)});return u.create=function(b,c){if(null==b||0==b.length)return one.log.error("Specify the elements to initialize by using the expression argument");var d=[];return $(b).each(function(b,e){var f=$(e).data("tooltip")||new a(e,c);d.push(f)}),d.length>1?d:d[0]},$.fn.tooltip=function(a){return this.each(function(b,c){u.create(c,a)})},u}();