one.controls.scroller=function a(){function b(){this.enabled?(this.$element.toggleClass("one-hscrollable",this.isScrollableHorizontally()),this.$element.toggleClass("one-vscrollable",this.isScrollableVertically())):this.$element.removeClass("one-hscrollable one-vscrollable")}function c(){this.$trackVertical.toggle()}function d(a){var b,c,d=one.HtmlControl.PROPS[a],e=a==z.HORIZONTAL?this.$trackHorizontal:this.$trackVertical,f=a==z.HORIZONTAL?this.$gripHorizontal:this.$gripVertical;a==z.HORIZONTAL?(b=parseInt(this.$gripVertical.css("top"))||0,c=parseInt(this.$gripVertical.css("bottom"))||0):(b=parseInt(this.$gripVertical.css("left"))||0,c=parseInt(this.$gripVertical.css("right"))||0);var g=this[d.scrollSize](),h=this.$element[d.size](),i=e[d.size](),j=f[d.size]();if(g>h){var k=parseInt(e.css(d.scrollPaddingSize));this.$content.css(d.scrollPadding,this.$content.data("_"+d.scrollPadding)+k),g=this[d.scrollSize]();var l=i-(b+c);this.scrollRatio[a]=l/g,j=Math.round(h*this.scrollRatio[a]),f.css(d.size,j),f.data("minScroll",b),f.data("maxScroll",i-j-c)}else this.$content.css(d.scrollPadding,this.$content.data("_"+d.scrollPadding))}function e(){var a=this.$scrollGrip,b=a.data("orientation"),c=one.HtmlControl.PROPS[b],d=a.position()[c.position],e=Math.round(d/this.scrollRatio[b]);this.$scroller.prop(c.scrollPos,e)}function f(){var a=this.$scroller.prop("scrollTop"),b=this.$scroller.prop("scrollLeft"),c=Math.round(a*this.scrollRatio[z.VERTICAL]),d=Math.round(b*this.scrollRatio[z.HORIZONTAL]);this.$gripVertical.css("top",Math.min(Math.max(this.$gripVertical.data("minScroll"),c),this.$gripVertical.data("maxScroll"))),this.$gripHorizontal.css("left",Math.min(Math.max(this.$gripHorizontal.data("minScroll"),d),this.$gripHorizontal.data("maxScroll")))}function g(a,b){j.call(this,a),this.$element.addClass(A[a]),b&&i.call(this,a,!0)}function h(a){this.$element.removeClass(A[a])}function i(a){j.call(this,a),this.switches[a].id=setTimeout($.proxy(h,this,a),this.switches[a].duration)}function j(a){this.switches[a]&&clearTimeout(this.switches[a].id)}function k(a){var b=$(a.currentTarget),c=b.closest(".one-scrolltrack");one.drag.on("move",this.onDragMove),one.drag.on("stop",this.onDragEnd);var d=b.data("orientation")==z.VERTICAL,e={moveX:!d,moveY:d,minX:this.$gripHorizontal.data("minScroll"),maxX:this.$gripHorizontal.data("maxScroll"),minY:this.$gripVertical.data("minScroll"),maxY:this.$gripVertical.data("maxScroll")};return one.drag.start(a,a.currentTarget,e),this.fireEvent("dragstart"),c.addClass("active"),this.$scrollGrip=b,this.scrollOrientation=d?z.VERTICAL:z.HORIZONTAL,!1}function l(){e.call(this)}function m(){one.drag.off("move",this.onDragMove),one.drag.off("stop",this.onDragEnd);var a=this.$scrollGrip.closest(".one-scrolltrack");a.removeClass("active"),this.scrollOrientation=null,this.fireEvent("dragend"),this.$trackVertical.removeClass("active")}function n(){g.call(this,"ENGAGED",!0),f.call(this),this.fireEvent("scroll")}function o(a){a.stopPropagation()}function p(a){a.stopPropagation()}function q(a){var b=$(a.currentTarget),c=b.find(".one-scrollgrip"),d=one.HtmlControl.PROPS[c.data("orientation")],e=parseInt(c.css(d.position)),f=parseInt(e+c[d.size]()),g=a[d.offsetPos];if(g<e||g>f){var h=this.$scroller[d.size](),i=this.$scroller.prop(d.scrollPos);g<e?(console.log("Moving from click to: "+(i-h)),this.$scroller.prop(d.scrollPos,i-h)):(console.log("Moving from click to: "+(i+h)),this.$scroller.prop(d.scrollPos,i+h))}}function r(a){one.event.isMouseInRange(a,this.$element)&&(this.mouseInRange||(g.call(this,"HOVER"),this.mouseInRange=!0,s.call(this,a))),one.event.isMouseInRange(a,this.$element)||this.mouseInRange&&(h.call(this,"HOVER"),this.mouseInRange=!1,t.call(this,a))}function s(a){if(this.isScrollable()&&this.enabled){g.call(this,"HOT",!0),a.stopPropagation(),b.call(this);for(var d=this.$element.parent();0!=d.length;){var e=d.data("scroller");null!=e&&c.call(this),d=d.parent()}}}function t(a){if(this.isScrollable()&&this.enabled){h.call(this,"HOT");for(var b=this.$element.parent();0!=b.length;){var d=b.data("scroller");null!=d&&c.call(this),b=b.parent()}}}function u(a){if(!this.enabled||!this.isScrollable())return!0;if(this.isScrollableVertically()||a.shiftKey)return!0;var b=this.$scroller.wheelDelta(a),c=this.scrollLeft();this.scrollLeft(c-30*b.deltaY)}function v(){var a=$("<div style='position: absolute; top:-1000px; left:-1000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo("body");return{width:a.width()-a[0].clientWidth,height:a.height()-a[0].clientHeight}}var w={},x={FIXED:0,PROPORTIONAL:1},y=null,z={VERTICAL:"VERTICAL",HORIZONTAL:"HORIZONTAL"},A={HOVER:"hover",HOT:"hot",ENGAGED:"engaged"},B=one.Settings.extend(function(a,b){var c=this.getString("sizing",a,b,"").toLowerCase();this.sizing="fixed"==c?x.FIXED:x.PROPORTIONAL,this.animate=this.getBoolean("animate",a,b,!0)}),a=one.HtmlControl.extend(function(a,b){this.construct(a,"scroll","dragstart","dragend"),this.settings=new B(a,b),this.mouseInRange=!1,null==y&&(y=v()),0==this.$element.find("> .one-scroller").length&&this.$element.html(one.string.format("<div class='one-scroller'><div class='one-scrollcontent'>{0}</div></div><div class='one-scrolltrack vertical'><div class='one-scrollgrip'/></div><div class='one-scrolltrack horizontal'><div class='one-scrollgrip'/></div>",this.$element.html())),this.$scroller=this.$element.find("> .one-scroller"),this.$content=this.$scroller.find("> .one-scrollcontent"),this.$trackVertical=this.$element.find("> .one-scrolltrack.vertical"),this.$gripVertical=this.$trackVertical.find("> .one-scrollgrip"),this.$trackHorizontal=this.$element.find("> .one-scrolltrack.horizontal"),this.$gripHorizontal=this.$trackHorizontal.find("> .one-scrollgrip"),this.$content.css("padding",this.$element.css("padding")),this.$content.data("_paddingRight",parseInt(this.$content.css("paddingRight"))||0),this.$content.data("_paddingBottom",parseInt(this.$content.css("paddingBottom"))||0),this.$scroller.css({right:-y.width,bottom:-y.height}),this.scrollRatio={},this.$scroller.on("scroll",$.proxy(n,this)),this.onDragMove=$.proxy(l,this),this.onDragEnd=$.proxy(m,this),this.offsetVertical=parseInt(this.$gripVertical.css("top"))||0,this.offsetHorizontal=parseInt(this.$gripHorizontal.css("left"))||0,this.scrollOrientation=null,this.enabled=!0,this.overflow=this.$scroller.css("overflow"),this.switches={HOVER:{id:0,duration:2e3},ENGAGED:{id:0,duration:500},HOT:{id:0,duration:1500}},one.dom.isTouchDevice()||$(document).on("mousemove",$.proxy(r,this)),this.$gripVertical.data("orientation",z.VERTICAL).on("mousedown",$.proxy(k,this)).on("click",one.event.cancel),this.$gripHorizontal.data("orientation",z.HORIZONTAL).on("mousedown",$.proxy(k,this)).on("click",one.event.cancel),this.$trackVertical.on("mouseenter",$.proxy(o,this)).on("mouseleave",$.proxy(p,this)).on("click",$.proxy(q,this)),this.$trackHorizontal.on("mouseenter",$.proxy(o,this)).on("mouseleave",$.proxy(p,this)).on("click",$.proxy(q,this)),this.$scroller.on("mousewheel DOMMouseScroll",$.proxy(u,this)),this.$element.data("scroller",this),this.redraw()});return a.prototype.enable=function(){this.enabled=!0,this.redraw(),this.isScrollable()&&(this.$scroller.css("overflow",one.string.EMPTY),this.$trackVertical.show())},a.prototype.disable=function(){this.enabled=!1,this.$trackVertical.hide(),this.$scroller.css("overflow","hidden")},a.prototype.isScrollable=function(){return this.isScrollableVertically()||this.isScrollableHorizontally()},a.prototype.isScrollableVertically=function(){var a=this.$scroller.prop("scrollHeight"),b=this.$scroller.outerHeight();return a>b},a.prototype.isScrollableHorizontally=function(){var a=this.$scroller.prop("scrollWidth"),b=this.$scroller.outerWidth();return a>b},a.prototype.scrollLeft=function(a){return!isNaN(a)&&a>=0&&this.$scroller.prop("scrollLeft",a),this.$scroller.prop("scrollLeft")},a.prototype.scrollTop=function(a){return!isNaN(a)&&a>=0&&this.$scroller.prop("scrollTop",a),this.$scroller.prop("scrollTop")},a.prototype.scrollHeight=function(a){return!isNaN(a)&&a>0&&(this.$content.css("height",a),this.redraw()),this.$content.prop("scrollHeight")},a.prototype.scrollWidth=function(a){return!isNaN(a)&&a>0&&(this.$content.css("width",a),this.redraw()),this.$content.prop("scrollWidth")},a.prototype.scrollMaxLeft=function(){return this.scrollWidth()-this.$content.width()},a.prototype.scrollMaxTop=function(){return this.scrollHeight()-this.$content.height()},a.prototype.scrollLeft=function(a){return this.enabled&&!isNaN(a)&&this.$scroller.prop("scrollLeft",a),this.$scroller.prop("scrollLeft")},a.prototype.scrollTop=function(a){return this.enabled&&!isNaN(a)&&this.$scroller.prop("scrollTop",a),this.$scroller.prop("scrollTop")},a.prototype.redraw=function(){d.call(this,z.VERTICAL),d.call(this,z.HORIZONTAL),b.call(this)},w.create=function(b,c){if(null==b||0==b.length)return one.log.error("Specify the elements to initialize by using the expression argument");var d=[];return $(b).each(function(b,e){var f=$(e).data("scroller")||new a(e,c);d.push(f)}),d.length>1?d:d[0]},$.fn.scroller=function(a){return this.each(function(b,c){w.create(c,a)})},w}();